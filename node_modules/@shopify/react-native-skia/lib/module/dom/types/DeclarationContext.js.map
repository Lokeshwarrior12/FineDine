{"version":3,"names":["_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","composeDeclarations","filters","composer","length","reverse","reduce","inner","outer","Declaration","constructor","index","indexes","save","push","decls","restore","pop","decl","popAll","splice","popAllAsOne","undefined","Error","DeclarationContext","Skia","peComp","PathEffect","MakeCompose","bind","ifComp","ImageFilter","cfComp","ColorFilter","paints","maskFilters","shaders","pathEffects","imageFilters","colorFilters"],"sources":["DeclarationContext.ts"],"sourcesContent":["\"worklet\";\n\nimport type {\n  SkShader,\n  SkPaint,\n  SkImageFilter,\n  SkMaskFilter,\n  SkPathEffect,\n  Skia,\n  SkColorFilter,\n} from \"../../skia/types\";\n\ntype Composer<T> = (outer: T, inner: T) => T;\n\nexport const composeDeclarations = <T>(filters: T[], composer: Composer<T>) => {\n  if (filters.length <= 1) {\n    return filters[0];\n  }\n  return filters.reverse().reduce((inner, outer) => {\n    if (!inner) {\n      return outer;\n    }\n    return composer(outer, inner);\n  });\n};\n\nclass Declaration<T> {\n  private decls: T[] = [];\n  private indexes = [0];\n  private composer?: Composer<T>;\n\n  constructor(composer?: Composer<T>) {\n    this.composer = composer;\n  }\n\n  private get index() {\n    return this.indexes[this.indexes.length - 1];\n  }\n\n  save() {\n    this.indexes.push(this.decls.length);\n  }\n\n  restore() {\n    this.indexes.pop();\n  }\n\n  pop() {\n    return this.decls.pop();\n  }\n\n  push(decl: T) {\n    this.decls.push(decl);\n  }\n\n  popAll() {\n    return this.decls.splice(this.index, this.decls.length - this.index);\n  }\n\n  popAllAsOne() {\n    if (this.decls.length === 0) {\n      return undefined;\n    }\n    if (!this.composer) {\n      throw new Error(\"No composer for this type of declaration\");\n    }\n    const decls = this.popAll();\n    return composeDeclarations(decls, this.composer!);\n  }\n}\n\nexport class DeclarationContext {\n  public Skia: Skia;\n  readonly paints: Declaration<SkPaint>;\n  readonly maskFilters: Declaration<SkMaskFilter>;\n  readonly shaders: Declaration<SkShader>;\n  readonly pathEffects: Declaration<SkPathEffect>;\n  readonly imageFilters: Declaration<SkImageFilter>;\n  readonly colorFilters: Declaration<SkColorFilter>;\n\n  constructor(Skia: Skia) {\n    this.Skia = Skia;\n    const peComp = this.Skia.PathEffect.MakeCompose.bind(this.Skia.PathEffect);\n    const ifComp = this.Skia.ImageFilter.MakeCompose.bind(\n      this.Skia.ImageFilter\n    );\n    const cfComp = this.Skia.ColorFilter.MakeCompose.bind(\n      this.Skia.ColorFilter\n    );\n    this.paints = new Declaration<SkPaint>();\n    this.maskFilters = new Declaration<SkMaskFilter>();\n    this.shaders = new Declaration<SkShader>();\n    this.pathEffects = new Declaration<SkPathEffect>(peComp);\n    this.imageFilters = new Declaration<SkImageFilter>(ifComp);\n    this.colorFilters = new Declaration<SkColorFilter>(cfComp);\n  }\n\n  save() {\n    this.paints.save();\n    this.maskFilters.save();\n    this.shaders.save();\n    this.pathEffects.save();\n    this.imageFilters.save();\n    this.colorFilters.save();\n  }\n\n  restore() {\n    this.paints.restore();\n    this.maskFilters.restore();\n    this.shaders.restore();\n    this.pathEffects.restore();\n    this.imageFilters.restore();\n    this.colorFilters.restore();\n  }\n}\n"],"mappings":"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","ignoreList":[]}