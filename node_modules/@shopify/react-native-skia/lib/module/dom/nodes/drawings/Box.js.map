{"version":3,"names":["BlurStyle","ClipOp","isRRect","NodeType","JsiDeclarationNode","JsiRenderNode","deflate","inflate","BoxShadowNode","constructor","ctx","props","BoxShadow","decorate","_ctx","materialize","BoxNode","Box","renderNode","canvas","paint","box","defaultBox","opacity","getAlphaf","Skia","RRectXY","shadows","_children","map","node","filter","n","shadow","inner","color","blur","spread","dx","dy","lPaint","Paint","setColor","Color","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","Normal","drawRRect","delta","Point","Math","abs","save","clipRRect","Intersect","outer","x","y","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { DrawingContext } from \"../../types\";\nimport { NodeType } from \"../../types\";\nimport type { BoxShadowProps, BoxProps } from \"../../types/Drawings\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport { JsiRenderNode } from \"../RenderNode\";\nimport type { DeclarationContext } from \"../../types/DeclarationContext\";\nimport { deflate, inflate } from \"../datatypes\";\n\nexport class BoxShadowNode extends JsiDeclarationNode<BoxShadowProps> {\n  constructor(ctx: NodeContext, props: BoxShadowProps) {\n    super(ctx, NodeType.BoxShadow, props);\n  }\n\n  decorate(_ctx: DeclarationContext) {\n    // do nothing\n  }\n\n  materialize() {\n    return this.props;\n  }\n}\n\nexport class BoxNode extends JsiRenderNode<BoxProps> {\n  constructor(ctx: NodeContext, props: BoxProps) {\n    super(ctx, NodeType.Box, props);\n  }\n\n  renderNode({ canvas, paint }: DrawingContext) {\n    const { box: defaultBox } = this.props;\n    const opacity = paint.getAlphaf();\n    const box = isRRect(defaultBox)\n      ? defaultBox\n      : this.Skia.RRectXY(defaultBox, 0, 0);\n    const shadows = this._children\n      .map((node) => {\n        if (node instanceof BoxShadowNode) {\n          return node.materialize();\n        }\n        return null;\n      })\n      .filter((n): n is BoxShadowProps => n !== null);\n    shadows\n      .filter((shadow) => !shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        canvas.drawRRect(\n          inflate(this.Skia, box, spread, spread, dx, dy),\n          lPaint\n        );\n      });\n\n    canvas.drawRRect(box, paint);\n\n    shadows\n      .filter((shadow) => shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const delta = this.Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n        canvas.save();\n        canvas.clipRRect(box, ClipOp.Intersect, false);\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        const inner = deflate(this.Skia, box, spread, spread, dx, dy);\n        const outer = inflate(this.Skia, box, delta.x, delta.y);\n        canvas.drawDRRect(outer, inner, lPaint);\n        canvas.restore();\n      });\n  }\n}\n"],"mappings":"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","ignoreList":[]}