{"version":3,"names":["composeDeclarations","NodeType","BlendMode","enumKey","drawAtlas","drawBox","drawBoxShadow","drawCircle","drawDiffRect","drawFill","drawGlyphs","drawImage","drawImageSVG","drawLine","drawOval","drawParagraph","drawPatch","drawPath","drawPicture","drawPoints","drawRect","drawRRect","drawText","drawTextBlob","drawTextPath","drawVertices","declareLerpColorFilter","makeBlendColorFilter","makeLinearToSRGBGammaColorFilter","makeLumaColorFilter","makeMatrixColorFilter","makeSRGBToLinearGammaColorFilter","declareBlendImageFilter","declareBlurMaskFilter","declareDisplacementMapImageFilter","makeBlurImageFilter","makeDropShadowImageFilter","makeMorphologyImageFilter","makeOffsetImageFilter","makeRuntimeShaderImageFilter","materialize","declareColorShader","declareFractalNoiseShader","declareImageShader","declareLinearGradientShader","declareRadialGradientShader","declareShader","declareSweepGradientShader","declareTurbulenceShader","declareTwoPointConicalGradientShader","declarePaint","declareSumPathEffect","makeCornerPathEffect","makeDashPathEffect","makeDiscretePathEffect","makeLine2DPathEffect","makePath1DPathEffect","makePath2DPathEffect","composeColorFilters","ctx","cf","processChildren","Skia","save","cf1","colorFilters","popAllAsOne","restore","push","ColorFilter","MakeCompose","composePathEffects","pe","pe1","pathEffects","PathEffect","composeImageFilters","imgf1","imgf2","imageFilters","_imgf","ImageFilter","MakeColorFilter","imgf","processDeclarations","node","children","forEach","child","type","props","BlurMaskFilter","LerpColorFilter","Blend","blend","mode","popAll","length","composer","MakeBlend","bind","shaders","Shader","BlendColorFilter","SRGBToLinearGammaColorFilter","LinearToSRGBGammaColorFilter","MatrixColorFilter","LumaColorFilter","ImageShader","ColorShader","Turbulence","FractalNoise","LinearGradient","RadialGradient","SweepGradient","TwoPointConicalGradient","BlurImageFilter","OffsetImageFilter","DisplacementMapImageFilter","DropShadowImageFilter","MorphologyImageFilter","BlendImageFilter","RuntimeShaderImageFilter","SumPathEffect","CornerPathEffect","pf","Path1DPathEffect","Path2DPathEffect","Line2DPathEffect","DashPathEffect","DiscretePathEffect","Paint","console","log","preProcessContext","shouldRestoreMatrix","processMatrixAndClipping","layer","declCtx","isDeclaration","shouldRestorePaint","processPaint","postProcessContext","canvas","drawBackdropFilter","imageFilter","pop","saveLayer","undefined","draw","BackdropFilter","Layer","hasLayer","paint","paints","map","rawProps","result","getLocalPaints","lctx","Box","BoxShadow","Image","Points","Path","Rect","RRect","Oval","Line","Patch","Vertices","DiffRect","Text","TextPath","TextBlob","Glyphs","Picture","ImageSVG","Paragraph","Atlas","Circle","Fill","Group","warn"],"sources":["context.ts"],"sourcesContent":["\"worklet\";\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { composeDeclarations, NodeType } from \"../../dom/types\";\nimport type {\n  BlendProps,\n  DeclarationContext,\n  DrawingNodeProps,\n} from \"../../dom/types\";\nimport type { DrawingContext } from \"../DrawingContext\";\nimport { BlendMode } from \"../../skia/types\";\nimport type {\n  SkPathEffect,\n  SkColorFilter,\n  SkImageFilter,\n} from \"../../skia/types\";\nimport { enumKey } from \"../../dom/nodes\";\n\nimport type { Node } from \"./Node\";\nimport {\n  drawAtlas,\n  drawBox,\n  drawBoxShadow,\n  drawCircle,\n  drawDiffRect,\n  drawFill,\n  drawGlyphs,\n  drawImage,\n  drawImageSVG,\n  drawLine,\n  drawOval,\n  drawParagraph,\n  drawPatch,\n  drawPath,\n  drawPicture,\n  drawPoints,\n  drawRect,\n  drawRRect,\n  drawText,\n  drawTextBlob,\n  drawTextPath,\n  drawVertices,\n} from \"./drawings\";\nimport {\n  declareLerpColorFilter,\n  makeBlendColorFilter,\n  makeLinearToSRGBGammaColorFilter,\n  makeLumaColorFilter,\n  makeMatrixColorFilter,\n  makeSRGBToLinearGammaColorFilter,\n} from \"./colorFilters\";\nimport {\n  declareBlendImageFilter,\n  declareBlurMaskFilter,\n  declareDisplacementMapImageFilter,\n  makeBlurImageFilter,\n  makeDropShadowImageFilter,\n  makeMorphologyImageFilter,\n  makeOffsetImageFilter,\n  makeRuntimeShaderImageFilter,\n} from \"./imageFilters\";\nimport { materialize } from \"./utils\";\nimport {\n  declareColorShader,\n  declareFractalNoiseShader,\n  declareImageShader,\n  declareLinearGradientShader,\n  declareRadialGradientShader,\n  declareShader,\n  declareSweepGradientShader,\n  declareTurbulenceShader,\n  declareTwoPointConicalGradientShader,\n} from \"./shaders\";\nimport { declarePaint } from \"./paint\";\nimport {\n  declareSumPathEffect,\n  makeCornerPathEffect,\n  makeDashPathEffect,\n  makeDiscretePathEffect,\n  makeLine2DPathEffect,\n  makePath1DPathEffect,\n  makePath2DPathEffect,\n} from \"./pathEffects\";\n\ninterface ContextProcessingResult {\n  shouldRestoreMatrix: boolean;\n  shouldRestorePaint: boolean;\n}\n\nfunction composeColorFilters(\n  ctx: DeclarationContext,\n  cf: SkColorFilter,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  const cf1 = ctx.colorFilters.popAllAsOne();\n  ctx.restore();\n  ctx.colorFilters.push(cf1 ? Skia.ColorFilter.MakeCompose(cf, cf1) : cf);\n}\n\nfunction composePathEffects(\n  ctx: DeclarationContext,\n  pe: SkPathEffect,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  const pe1 = ctx.pathEffects.popAllAsOne();\n  ctx.restore();\n  ctx.pathEffects.push(pe1 ? Skia.PathEffect.MakeCompose(pe, pe1) : pe);\n}\n\nfunction composeImageFilters(\n  ctx: DeclarationContext,\n  imgf1: SkImageFilter,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  let imgf2 = ctx.imageFilters.popAllAsOne();\n  const cf = ctx.colorFilters.popAllAsOne();\n  ctx.restore();\n  if (cf) {\n    imgf2 = Skia.ImageFilter.MakeCompose(\n      imgf2 ?? null,\n      Skia.ImageFilter.MakeColorFilter(cf, null)\n    );\n  }\n  const imgf = imgf2 ? Skia.ImageFilter.MakeCompose(imgf1, imgf2) : imgf1;\n  ctx.imageFilters.push(imgf);\n}\n\nfunction processDeclarations(ctx: DeclarationContext, node: Node<any>) {\n  const processChildren = () =>\n    node.children.forEach((child) => processDeclarations(ctx, child));\n  const { type } = node;\n  const props = materialize(node.props);\n  switch (type) {\n    // Mask Filter\n    case NodeType.BlurMaskFilter: {\n      declareBlurMaskFilter(ctx, props);\n      break;\n    }\n    // Color Filters\n    case NodeType.LerpColorFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareLerpColorFilter(ctx, props);\n      break;\n    }\n    case NodeType.Blend: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      const { Skia } = ctx;\n      const blend = BlendMode[enumKey(props.mode as BlendProps[\"mode\"])];\n      // Blend ImageFilters\n      const imageFilters = ctx.imageFilters.popAll();\n      if (imageFilters.length > 0) {\n        const composer = Skia.ImageFilter.MakeBlend.bind(\n          Skia.ImageFilter,\n          blend\n        );\n        ctx.imageFilters.push(composeDeclarations(imageFilters, composer));\n      }\n      // Blend Shaders\n      const shaders = ctx.shaders.popAll();\n      if (shaders.length > 0) {\n        const composer = Skia.Shader.MakeBlend.bind(Skia.Shader, blend);\n        ctx.shaders.push(composeDeclarations(shaders, composer));\n      }\n      break;\n    }\n    case NodeType.BlendColorFilter: {\n      const cf = makeBlendColorFilter(ctx, props);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.SRGBToLinearGammaColorFilter: {\n      const cf = makeSRGBToLinearGammaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.LinearToSRGBGammaColorFilter: {\n      const cf = makeLinearToSRGBGammaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.MatrixColorFilter: {\n      const cf = makeMatrixColorFilter(ctx, props);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.LumaColorFilter: {\n      const cf = makeLumaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    // Shaders\n    case NodeType.Shader: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareShader(ctx, props);\n      break;\n    }\n    case NodeType.ImageShader: {\n      declareImageShader(ctx, props);\n      break;\n    }\n    case NodeType.ColorShader: {\n      declareColorShader(ctx, props);\n      break;\n    }\n    case NodeType.Turbulence: {\n      declareTurbulenceShader(ctx, props);\n      break;\n    }\n    case NodeType.FractalNoise: {\n      declareFractalNoiseShader(ctx, props);\n      break;\n    }\n    case NodeType.LinearGradient: {\n      declareLinearGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.RadialGradient: {\n      declareRadialGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.SweepGradient: {\n      declareSweepGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.TwoPointConicalGradient: {\n      declareTwoPointConicalGradientShader(ctx, props);\n      break;\n    }\n    // Image Filters\n    case NodeType.BlurImageFilter: {\n      const imgf = makeBlurImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.OffsetImageFilter: {\n      const imgf = makeOffsetImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.DisplacementMapImageFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareDisplacementMapImageFilter(ctx, props);\n      break;\n    }\n    case NodeType.DropShadowImageFilter: {\n      const imgf = makeDropShadowImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.MorphologyImageFilter: {\n      const imgf = makeMorphologyImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.BlendImageFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareBlendImageFilter(ctx, props);\n      break;\n    }\n    case NodeType.RuntimeShaderImageFilter: {\n      const imgf = makeRuntimeShaderImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    // Path Effects\n    case NodeType.SumPathEffect: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareSumPathEffect(ctx);\n      break;\n    }\n    case NodeType.CornerPathEffect: {\n      const pf = makeCornerPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Path1DPathEffect: {\n      const pf = makePath1DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Path2DPathEffect: {\n      const pf = makePath2DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Line2DPathEffect: {\n      const pf = makeLine2DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.DashPathEffect: {\n      const pf = makeDashPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.DiscretePathEffect: {\n      const pf = makeDiscretePathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    // Paint\n    case NodeType.Paint:\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declarePaint(ctx, props);\n      break;\n    default:\n      console.log(\"Unknown declaration node: \", type);\n  }\n}\n\nconst preProcessContext = (\n  ctx: DrawingContext,\n  props: DrawingNodeProps,\n  node: Node<any>\n) => {\n  const shouldRestoreMatrix = ctx.processMatrixAndClipping(props, props.layer);\n  ctx.declCtx.save();\n  node.children.forEach((child) => {\n    if (child.isDeclaration) {\n      processDeclarations(ctx.declCtx, child);\n    }\n  });\n  const shouldRestorePaint = ctx.processPaint(props);\n  ctx.declCtx.restore();\n  return { shouldRestoreMatrix, shouldRestorePaint };\n};\n\nconst postProcessContext = (\n  ctx: DrawingContext,\n  { shouldRestoreMatrix, shouldRestorePaint }: ContextProcessingResult\n) => {\n  if (shouldRestoreMatrix) {\n    ctx.canvas.restore();\n  }\n  if (shouldRestorePaint) {\n    ctx.restore();\n  }\n};\n\nconst drawBackdropFilter = (ctx: DrawingContext, node: Node) => {\n  const { canvas, Skia } = ctx;\n  const child = node.children[0];\n  let imageFilter: SkImageFilter | null = null;\n  if (child.isDeclaration) {\n    ctx.declCtx.save();\n    processDeclarations(ctx.declCtx, child);\n    const imgf = ctx.declCtx.imageFilters.pop();\n    if (imgf) {\n      imageFilter = imgf;\n    } else {\n      const cf = ctx.declCtx.colorFilters.pop();\n      if (cf) {\n        imageFilter = Skia.ImageFilter.MakeColorFilter(cf, null);\n      }\n    }\n    ctx.declCtx.restore();\n  }\n  canvas.saveLayer(undefined, null, imageFilter);\n  canvas.restore();\n};\n\nexport function draw(ctx: DrawingContext, node: Node<any>) {\n  // Special mixed nodes\n  if (node.type === NodeType.BackdropFilter) {\n    drawBackdropFilter(ctx, node);\n    return;\n  }\n  if (node.type === NodeType.Layer) {\n    let hasLayer = false;\n    const [layer, ...children] = node.children;\n    if (layer.isDeclaration) {\n      const { declCtx } = ctx;\n      declCtx.save();\n      processDeclarations(ctx.declCtx, layer);\n      const paint = declCtx.paints.pop();\n      declCtx.restore();\n      if (paint) {\n        hasLayer = true;\n        ctx.canvas.saveLayer(paint);\n      }\n    }\n    children.map((child) => {\n      if (!child.isDeclaration) {\n        draw(ctx, child);\n      }\n    });\n    if (hasLayer) {\n      ctx.canvas.restore();\n    }\n    return;\n  }\n  const { type, props: rawProps, children } = node;\n  // Regular nodes\n  const props = materialize(rawProps);\n  const result = preProcessContext(ctx, props, node);\n  const paints = ctx.getLocalPaints();\n  paints.forEach((paint) => {\n    const lctx = { paint, Skia: ctx.Skia, canvas: ctx.canvas };\n    switch (type) {\n      case NodeType.Box:\n        drawBox(lctx, props, node.children);\n        break;\n      case NodeType.BoxShadow:\n        drawBoxShadow(lctx, props);\n        break;\n      case NodeType.Image:\n        drawImage(lctx, props);\n        break;\n      case NodeType.Points:\n        drawPoints(lctx, props);\n        break;\n      case NodeType.Path:\n        drawPath(lctx, props);\n        break;\n      case NodeType.Rect:\n        drawRect(lctx, props);\n        break;\n      case NodeType.RRect:\n        drawRRect(lctx, props);\n        break;\n      case NodeType.Oval:\n        drawOval(lctx, props);\n        break;\n      case NodeType.Line:\n        drawLine(lctx, props);\n        break;\n      case NodeType.Patch:\n        drawPatch(lctx, props);\n        break;\n      case NodeType.Vertices:\n        drawVertices(lctx, props);\n        break;\n      case NodeType.DiffRect:\n        drawDiffRect(lctx, props);\n        break;\n      case NodeType.Text:\n        drawText(lctx, props);\n        break;\n      case NodeType.TextPath:\n        drawTextPath(lctx, props);\n        break;\n      case NodeType.TextBlob:\n        drawTextBlob(lctx, props);\n        break;\n      case NodeType.Glyphs:\n        drawGlyphs(lctx, props);\n        break;\n      case NodeType.Picture:\n        drawPicture(lctx, props);\n        break;\n      case NodeType.ImageSVG:\n        drawImageSVG(lctx, props);\n        break;\n      case NodeType.Paragraph:\n        drawParagraph(lctx, props);\n        break;\n      case NodeType.Atlas:\n        drawAtlas(lctx, props);\n        break;\n      case NodeType.Circle:\n        drawCircle(lctx, props);\n        break;\n      case NodeType.Fill:\n        drawFill(lctx, props);\n        break;\n      case NodeType.Group:\n        // TODO: do nothing\n        break;\n      default:\n        if (!node.isDeclaration) {\n          console.warn(`Unsupported node type: ${type}`);\n        }\n    }\n  });\n  children.forEach((child) => {\n    if (!child.isDeclaration) {\n      draw(ctx, child);\n    }\n  });\n  postProcessContext(ctx, result);\n}\n"],"mappings":"AAAA,SAAS;;AACT;AACA,SAASA,mBAAmB,EAAEC,QAAQ,QAAQ,iBAAiB;AAO/D,SAASC,SAAS,QAAQ,kBAAkB;AAM5C,SAASC,OAAO,QAAQ,iBAAiB;AAGzC,SACEC,SAAS,EACTC,OAAO,EACPC,aAAa,EACbC,UAAU,EACVC,YAAY,EACZC,QAAQ,EACRC,UAAU,EACVC,SAAS,EACTC,YAAY,EACZC,QAAQ,EACRC,QAAQ,EACRC,aAAa,EACbC,SAAS,EACTC,QAAQ,EACRC,WAAW,EACXC,UAAU,EACVC,QAAQ,EACRC,SAAS,EACTC,QAAQ,EACRC,YAAY,EACZC,YAAY,EACZC,YAAY,QACP,YAAY;AACnB,SACEC,sBAAsB,EACtBC,oBAAoB,EACpBC,gCAAgC,EAChCC,mBAAmB,EACnBC,qBAAqB,EACrBC,gCAAgC,QAC3B,gBAAgB;AACvB,SACEC,uBAAuB,EACvBC,qBAAqB,EACrBC,iCAAiC,EACjCC,mBAAmB,EACnBC,yBAAyB,EACzBC,yBAAyB,EACzBC,qBAAqB,EACrBC,4BAA4B,QACvB,gBAAgB;AACvB,SAASC,WAAW,QAAQ,SAAS;AACrC,SACEC,kBAAkB,EAClBC,yBAAyB,EACzBC,kBAAkB,EAClBC,2BAA2B,EAC3BC,2BAA2B,EAC3BC,aAAa,EACbC,0BAA0B,EAC1BC,uBAAuB,EACvBC,oCAAoC,QAC/B,WAAW;AAClB,SAASC,YAAY,QAAQ,SAAS;AACtC,SACEC,oBAAoB,EACpBC,oBAAoB,EACpBC,kBAAkB,EAClBC,sBAAsB,EACtBC,oBAAoB,EACpBC,oBAAoB,EACpBC,oBAAoB,QACf,eAAe;AAOtB,SAASC,mBAAmBA,CAC1BC,GAAuB,EACvBC,EAAiB,EACjBC,eAA2B,EAC3B;EACA,MAAM;IAAEC;EAAK,CAAC,GAAGH,GAAG;EACpBA,GAAG,CAACI,IAAI,CAAC,CAAC;EACVF,eAAe,CAAC,CAAC;EACjB,MAAMG,GAAG,GAAGL,GAAG,CAACM,YAAY,CAACC,WAAW,CAAC,CAAC;EAC1CP,GAAG,CAACQ,OAAO,CAAC,CAAC;EACbR,GAAG,CAACM,YAAY,CAACG,IAAI,CAACJ,GAAG,GAAGF,IAAI,CAACO,WAAW,CAACC,WAAW,CAACV,EAAE,EAAEI,GAAG,CAAC,GAAGJ,EAAE,CAAC;AACzE;AAEA,SAASW,kBAAkBA,CACzBZ,GAAuB,EACvBa,EAAgB,EAChBX,eAA2B,EAC3B;EACA,MAAM;IAAEC;EAAK,CAAC,GAAGH,GAAG;EACpBA,GAAG,CAACI,IAAI,CAAC,CAAC;EACVF,eAAe,CAAC,CAAC;EACjB,MAAMY,GAAG,GAAGd,GAAG,CAACe,WAAW,CAACR,WAAW,CAAC,CAAC;EACzCP,GAAG,CAACQ,OAAO,CAAC,CAAC;EACbR,GAAG,CAACe,WAAW,CAACN,IAAI,CAACK,GAAG,GAAGX,IAAI,CAACa,UAAU,CAACL,WAAW,CAACE,EAAE,EAAEC,GAAG,CAAC,GAAGD,EAAE,CAAC;AACvE;AAEA,SAASI,mBAAmBA,CAC1BjB,GAAuB,EACvBkB,KAAoB,EACpBhB,eAA2B,EAC3B;EACA,MAAM;IAAEC;EAAK,CAAC,GAAGH,GAAG;EACpBA,GAAG,CAACI,IAAI,CAAC,CAAC;EACVF,eAAe,CAAC,CAAC;EACjB,IAAIiB,KAAK,GAAGnB,GAAG,CAACoB,YAAY,CAACb,WAAW,CAAC,CAAC;EAC1C,MAAMN,EAAE,GAAGD,GAAG,CAACM,YAAY,CAACC,WAAW,CAAC,CAAC;EACzCP,GAAG,CAACQ,OAAO,CAAC,CAAC;EACb,IAAIP,EAAE,EAAE;IAAA,IAAAoB,KAAA;IACNF,KAAK,GAAGhB,IAAI,CAACmB,WAAW,CAACX,WAAW,EAAAU,KAAA,GAClCF,KAAK,cAAAE,KAAA,cAAAA,KAAA,GAAI,IAAI,EACblB,IAAI,CAACmB,WAAW,CAACC,eAAe,CAACtB,EAAE,EAAE,IAAI,CAC3C,CAAC;EACH;EACA,MAAMuB,IAAI,GAAGL,KAAK,GAAGhB,IAAI,CAACmB,WAAW,CAACX,WAAW,CAACO,KAAK,EAAEC,KAAK,CAAC,GAAGD,KAAK;EACvElB,GAAG,CAACoB,YAAY,CAACX,IAAI,CAACe,IAAI,CAAC;AAC7B;AAEA,SAASC,mBAAmBA,CAACzB,GAAuB,EAAE0B,IAAe,EAAE;EACrE,MAAMxB,eAAe,GAAGA,CAAA,KACtBwB,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;EACnE,MAAM;IAAEC;EAAK,CAAC,GAAGJ,IAAI;EACrB,MAAMK,KAAK,GAAGlD,WAAW,CAAC6C,IAAI,CAACK,KAAK,CAAC;EACrC,QAAQD,IAAI;IACV;IACA,KAAKxF,QAAQ,CAAC0F,cAAc;MAAE;QAC5B1D,qBAAqB,CAAC0B,GAAG,EAAE+B,KAAK,CAAC;QACjC;MACF;IACA;IACA,KAAKzF,QAAQ,CAAC2F,eAAe;MAAE;QAC7BP,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjE9D,sBAAsB,CAACiC,GAAG,EAAE+B,KAAK,CAAC;QAClC;MACF;IACA,KAAKzF,QAAQ,CAAC4F,KAAK;MAAE;QACnBR,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjE,MAAM;UAAE1B;QAAK,CAAC,GAAGH,GAAG;QACpB,MAAMmC,KAAK,GAAG5F,SAAS,CAACC,OAAO,CAACuF,KAAK,CAACK,IAA0B,CAAC,CAAC;QAClE;QACA,MAAMhB,YAAY,GAAGpB,GAAG,CAACoB,YAAY,CAACiB,MAAM,CAAC,CAAC;QAC9C,IAAIjB,YAAY,CAACkB,MAAM,GAAG,CAAC,EAAE;UAC3B,MAAMC,QAAQ,GAAGpC,IAAI,CAACmB,WAAW,CAACkB,SAAS,CAACC,IAAI,CAC9CtC,IAAI,CAACmB,WAAW,EAChBa,KACF,CAAC;UACDnC,GAAG,CAACoB,YAAY,CAACX,IAAI,CAACpE,mBAAmB,CAAC+E,YAAY,EAAEmB,QAAQ,CAAC,CAAC;QACpE;QACA;QACA,MAAMG,OAAO,GAAG1C,GAAG,CAAC0C,OAAO,CAACL,MAAM,CAAC,CAAC;QACpC,IAAIK,OAAO,CAACJ,MAAM,GAAG,CAAC,EAAE;UACtB,MAAMC,QAAQ,GAAGpC,IAAI,CAACwC,MAAM,CAACH,SAAS,CAACC,IAAI,CAACtC,IAAI,CAACwC,MAAM,EAAER,KAAK,CAAC;UAC/DnC,GAAG,CAAC0C,OAAO,CAACjC,IAAI,CAACpE,mBAAmB,CAACqG,OAAO,EAAEH,QAAQ,CAAC,CAAC;QAC1D;QACA;MACF;IACA,KAAKjG,QAAQ,CAACsG,gBAAgB;MAAE;QAC9B,MAAM3C,EAAE,GAAGjC,oBAAoB,CAACgC,GAAG,EAAE+B,KAAK,CAAC;QAC3ChC,mBAAmB,CAACC,GAAG,EAAEC,EAAE,EAAEC,eAAe,CAAC;QAC7C;MACF;IACA,KAAK5D,QAAQ,CAACuG,4BAA4B;MAAE;QAC1C,MAAM5C,EAAE,GAAG7B,gCAAgC,CAAC4B,GAAG,CAAC;QAChDD,mBAAmB,CAACC,GAAG,EAAEC,EAAE,EAAEC,eAAe,CAAC;QAC7C;MACF;IACA,KAAK5D,QAAQ,CAACwG,4BAA4B;MAAE;QAC1C,MAAM7C,EAAE,GAAGhC,gCAAgC,CAAC+B,GAAG,CAAC;QAChDD,mBAAmB,CAACC,GAAG,EAAEC,EAAE,EAAEC,eAAe,CAAC;QAC7C;MACF;IACA,KAAK5D,QAAQ,CAACyG,iBAAiB;MAAE;QAC/B,MAAM9C,EAAE,GAAG9B,qBAAqB,CAAC6B,GAAG,EAAE+B,KAAK,CAAC;QAC5ChC,mBAAmB,CAACC,GAAG,EAAEC,EAAE,EAAEC,eAAe,CAAC;QAC7C;MACF;IACA,KAAK5D,QAAQ,CAAC0G,eAAe;MAAE;QAC7B,MAAM/C,EAAE,GAAG/B,mBAAmB,CAAC8B,GAAG,CAAC;QACnCD,mBAAmB,CAACC,GAAG,EAAEC,EAAE,EAAEC,eAAe,CAAC;QAC7C;MACF;IACA;IACA,KAAK5D,QAAQ,CAACqG,MAAM;MAAE;QACpBjB,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjE1C,aAAa,CAACa,GAAG,EAAE+B,KAAK,CAAC;QACzB;MACF;IACA,KAAKzF,QAAQ,CAAC2G,WAAW;MAAE;QACzBjE,kBAAkB,CAACgB,GAAG,EAAE+B,KAAK,CAAC;QAC9B;MACF;IACA,KAAKzF,QAAQ,CAAC4G,WAAW;MAAE;QACzBpE,kBAAkB,CAACkB,GAAG,EAAE+B,KAAK,CAAC;QAC9B;MACF;IACA,KAAKzF,QAAQ,CAAC6G,UAAU;MAAE;QACxB9D,uBAAuB,CAACW,GAAG,EAAE+B,KAAK,CAAC;QACnC;MACF;IACA,KAAKzF,QAAQ,CAAC8G,YAAY;MAAE;QAC1BrE,yBAAyB,CAACiB,GAAG,EAAE+B,KAAK,CAAC;QACrC;MACF;IACA,KAAKzF,QAAQ,CAAC+G,cAAc;MAAE;QAC5BpE,2BAA2B,CAACe,GAAG,EAAE+B,KAAK,CAAC;QACvC;MACF;IACA,KAAKzF,QAAQ,CAACgH,cAAc;MAAE;QAC5BpE,2BAA2B,CAACc,GAAG,EAAE+B,KAAK,CAAC;QACvC;MACF;IACA,KAAKzF,QAAQ,CAACiH,aAAa;MAAE;QAC3BnE,0BAA0B,CAACY,GAAG,EAAE+B,KAAK,CAAC;QACtC;MACF;IACA,KAAKzF,QAAQ,CAACkH,uBAAuB;MAAE;QACrClE,oCAAoC,CAACU,GAAG,EAAE+B,KAAK,CAAC;QAChD;MACF;IACA;IACA,KAAKzF,QAAQ,CAACmH,eAAe;MAAE;QAC7B,MAAMjC,IAAI,GAAGhD,mBAAmB,CAACwB,GAAG,EAAE+B,KAAK,CAAC;QAC5Cd,mBAAmB,CAACjB,GAAG,EAAEwB,IAAI,EAAEtB,eAAe,CAAC;QAC/C;MACF;IACA,KAAK5D,QAAQ,CAACoH,iBAAiB;MAAE;QAC/B,MAAMlC,IAAI,GAAG7C,qBAAqB,CAACqB,GAAG,EAAE+B,KAAK,CAAC;QAC9Cd,mBAAmB,CAACjB,GAAG,EAAEwB,IAAI,EAAEtB,eAAe,CAAC;QAC/C;MACF;IACA,KAAK5D,QAAQ,CAACqH,0BAA0B;MAAE;QACxCjC,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjEtD,iCAAiC,CAACyB,GAAG,EAAE+B,KAAK,CAAC;QAC7C;MACF;IACA,KAAKzF,QAAQ,CAACsH,qBAAqB;MAAE;QACnC,MAAMpC,IAAI,GAAG/C,yBAAyB,CAACuB,GAAG,EAAE+B,KAAK,CAAC;QAClDd,mBAAmB,CAACjB,GAAG,EAAEwB,IAAI,EAAEtB,eAAe,CAAC;QAC/C;MACF;IACA,KAAK5D,QAAQ,CAACuH,qBAAqB;MAAE;QACnC,MAAMrC,IAAI,GAAG9C,yBAAyB,CAACsB,GAAG,EAAE+B,KAAK,CAAC;QAClDd,mBAAmB,CAACjB,GAAG,EAAEwB,IAAI,EAAEtB,eAAe,CAAC;QAC/C;MACF;IACA,KAAK5D,QAAQ,CAACwH,gBAAgB;MAAE;QAC9BpC,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjExD,uBAAuB,CAAC2B,GAAG,EAAE+B,KAAK,CAAC;QACnC;MACF;IACA,KAAKzF,QAAQ,CAACyH,wBAAwB;MAAE;QACtC,MAAMvC,IAAI,GAAG5C,4BAA4B,CAACoB,GAAG,EAAE+B,KAAK,CAAC;QACrDd,mBAAmB,CAACjB,GAAG,EAAEwB,IAAI,EAAEtB,eAAe,CAAC;QAC/C;MACF;IACA;IACA,KAAK5D,QAAQ,CAAC0H,aAAa;MAAE;QAC3BtC,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;QACjErC,oBAAoB,CAACQ,GAAG,CAAC;QACzB;MACF;IACA,KAAK1D,QAAQ,CAAC2H,gBAAgB;MAAE;QAC9B,MAAMC,EAAE,GAAGzE,oBAAoB,CAACO,GAAG,EAAE+B,KAAK,CAAC;QAC3CnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA,KAAK5D,QAAQ,CAAC6H,gBAAgB;MAAE;QAC9B,MAAMD,EAAE,GAAGrE,oBAAoB,CAACG,GAAG,EAAE+B,KAAK,CAAC;QAC3CnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA,KAAK5D,QAAQ,CAAC8H,gBAAgB;MAAE;QAC9B,MAAMF,EAAE,GAAGpE,oBAAoB,CAACE,GAAG,EAAE+B,KAAK,CAAC;QAC3CnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA,KAAK5D,QAAQ,CAAC+H,gBAAgB;MAAE;QAC9B,MAAMH,EAAE,GAAGtE,oBAAoB,CAACI,GAAG,EAAE+B,KAAK,CAAC;QAC3CnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA,KAAK5D,QAAQ,CAACgI,cAAc;MAAE;QAC5B,MAAMJ,EAAE,GAAGxE,kBAAkB,CAACM,GAAG,EAAE+B,KAAK,CAAC;QACzCnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA,KAAK5D,QAAQ,CAACiI,kBAAkB;MAAE;QAChC,MAAML,EAAE,GAAGvE,sBAAsB,CAACK,GAAG,EAAE+B,KAAK,CAAC;QAC7CnB,kBAAkB,CAACZ,GAAG,EAAEkE,EAAE,EAAEhE,eAAe,CAAC;QAC5C;MACF;IACA;IACA,KAAK5D,QAAQ,CAACkI,KAAK;MACjB9C,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAKJ,mBAAmB,CAACzB,GAAG,EAAE6B,KAAK,CAAC,CAAC;MACjEtC,YAAY,CAACS,GAAG,EAAE+B,KAAK,CAAC;MACxB;IACF;MACE0C,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAE5C,IAAI,CAAC;EACnD;AACF;AAEA,MAAM6C,iBAAiB,GAAGA,CACxB3E,GAAmB,EACnB+B,KAAuB,EACvBL,IAAe,KACZ;EACH,MAAMkD,mBAAmB,GAAG5E,GAAG,CAAC6E,wBAAwB,CAAC9C,KAAK,EAAEA,KAAK,CAAC+C,KAAK,CAAC;EAC5E9E,GAAG,CAAC+E,OAAO,CAAC3E,IAAI,CAAC,CAAC;EAClBsB,IAAI,CAACC,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAK;IAC/B,IAAIA,KAAK,CAACmD,aAAa,EAAE;MACvBvD,mBAAmB,CAACzB,GAAG,CAAC+E,OAAO,EAAElD,KAAK,CAAC;IACzC;EACF,CAAC,CAAC;EACF,MAAMoD,kBAAkB,GAAGjF,GAAG,CAACkF,YAAY,CAACnD,KAAK,CAAC;EAClD/B,GAAG,CAAC+E,OAAO,CAACvE,OAAO,CAAC,CAAC;EACrB,OAAO;IAAEoE,mBAAmB;IAAEK;EAAmB,CAAC;AACpD,CAAC;AAED,MAAME,kBAAkB,GAAGA,CACzBnF,GAAmB,EACnB;EAAE4E,mBAAmB;EAAEK;AAA4C,CAAC,KACjE;EACH,IAAIL,mBAAmB,EAAE;IACvB5E,GAAG,CAACoF,MAAM,CAAC5E,OAAO,CAAC,CAAC;EACtB;EACA,IAAIyE,kBAAkB,EAAE;IACtBjF,GAAG,CAACQ,OAAO,CAAC,CAAC;EACf;AACF,CAAC;AAED,MAAM6E,kBAAkB,GAAGA,CAACrF,GAAmB,EAAE0B,IAAU,KAAK;EAC9D,MAAM;IAAE0D,MAAM;IAAEjF;EAAK,CAAC,GAAGH,GAAG;EAC5B,MAAM6B,KAAK,GAAGH,IAAI,CAACC,QAAQ,CAAC,CAAC,CAAC;EAC9B,IAAI2D,WAAiC,GAAG,IAAI;EAC5C,IAAIzD,KAAK,CAACmD,aAAa,EAAE;IACvBhF,GAAG,CAAC+E,OAAO,CAAC3E,IAAI,CAAC,CAAC;IAClBqB,mBAAmB,CAACzB,GAAG,CAAC+E,OAAO,EAAElD,KAAK,CAAC;IACvC,MAAML,IAAI,GAAGxB,GAAG,CAAC+E,OAAO,CAAC3D,YAAY,CAACmE,GAAG,CAAC,CAAC;IAC3C,IAAI/D,IAAI,EAAE;MACR8D,WAAW,GAAG9D,IAAI;IACpB,CAAC,MAAM;MACL,MAAMvB,EAAE,GAAGD,GAAG,CAAC+E,OAAO,CAACzE,YAAY,CAACiF,GAAG,CAAC,CAAC;MACzC,IAAItF,EAAE,EAAE;QACNqF,WAAW,GAAGnF,IAAI,CAACmB,WAAW,CAACC,eAAe,CAACtB,EAAE,EAAE,IAAI,CAAC;MAC1D;IACF;IACAD,GAAG,CAAC+E,OAAO,CAACvE,OAAO,CAAC,CAAC;EACvB;EACA4E,MAAM,CAACI,SAAS,CAACC,SAAS,EAAE,IAAI,EAAEH,WAAW,CAAC;EAC9CF,MAAM,CAAC5E,OAAO,CAAC,CAAC;AAClB,CAAC;AAED,OAAO,SAASkF,IAAIA,CAAC1F,GAAmB,EAAE0B,IAAe,EAAE;EACzD;EACA,IAAIA,IAAI,CAACI,IAAI,KAAKxF,QAAQ,CAACqJ,cAAc,EAAE;IACzCN,kBAAkB,CAACrF,GAAG,EAAE0B,IAAI,CAAC;IAC7B;EACF;EACA,IAAIA,IAAI,CAACI,IAAI,KAAKxF,QAAQ,CAACsJ,KAAK,EAAE;IAChC,IAAIC,QAAQ,GAAG,KAAK;IACpB,MAAM,CAACf,KAAK,EAAE,GAAGnD,QAAQ,CAAC,GAAGD,IAAI,CAACC,QAAQ;IAC1C,IAAImD,KAAK,CAACE,aAAa,EAAE;MACvB,MAAM;QAAED;MAAQ,CAAC,GAAG/E,GAAG;MACvB+E,OAAO,CAAC3E,IAAI,CAAC,CAAC;MACdqB,mBAAmB,CAACzB,GAAG,CAAC+E,OAAO,EAAED,KAAK,CAAC;MACvC,MAAMgB,KAAK,GAAGf,OAAO,CAACgB,MAAM,CAACR,GAAG,CAAC,CAAC;MAClCR,OAAO,CAACvE,OAAO,CAAC,CAAC;MACjB,IAAIsF,KAAK,EAAE;QACTD,QAAQ,GAAG,IAAI;QACf7F,GAAG,CAACoF,MAAM,CAACI,SAAS,CAACM,KAAK,CAAC;MAC7B;IACF;IACAnE,QAAQ,CAACqE,GAAG,CAAEnE,KAAK,IAAK;MACtB,IAAI,CAACA,KAAK,CAACmD,aAAa,EAAE;QACxBU,IAAI,CAAC1F,GAAG,EAAE6B,KAAK,CAAC;MAClB;IACF,CAAC,CAAC;IACF,IAAIgE,QAAQ,EAAE;MACZ7F,GAAG,CAACoF,MAAM,CAAC5E,OAAO,CAAC,CAAC;IACtB;IACA;EACF;EACA,MAAM;IAAEsB,IAAI;IAAEC,KAAK,EAAEkE,QAAQ;IAAEtE;EAAS,CAAC,GAAGD,IAAI;EAChD;EACA,MAAMK,KAAK,GAAGlD,WAAW,CAACoH,QAAQ,CAAC;EACnC,MAAMC,MAAM,GAAGvB,iBAAiB,CAAC3E,GAAG,EAAE+B,KAAK,EAAEL,IAAI,CAAC;EAClD,MAAMqE,MAAM,GAAG/F,GAAG,CAACmG,cAAc,CAAC,CAAC;EACnCJ,MAAM,CAACnE,OAAO,CAAEkE,KAAK,IAAK;IACxB,MAAMM,IAAI,GAAG;MAAEN,KAAK;MAAE3F,IAAI,EAAEH,GAAG,CAACG,IAAI;MAAEiF,MAAM,EAAEpF,GAAG,CAACoF;IAAO,CAAC;IAC1D,QAAQtD,IAAI;MACV,KAAKxF,QAAQ,CAAC+J,GAAG;QACf3J,OAAO,CAAC0J,IAAI,EAAErE,KAAK,EAAEL,IAAI,CAACC,QAAQ,CAAC;QACnC;MACF,KAAKrF,QAAQ,CAACgK,SAAS;QACrB3J,aAAa,CAACyJ,IAAI,EAAErE,KAAK,CAAC;QAC1B;MACF,KAAKzF,QAAQ,CAACiK,KAAK;QACjBvJ,SAAS,CAACoJ,IAAI,EAAErE,KAAK,CAAC;QACtB;MACF,KAAKzF,QAAQ,CAACkK,MAAM;QAClBhJ,UAAU,CAAC4I,IAAI,EAAErE,KAAK,CAAC;QACvB;MACF,KAAKzF,QAAQ,CAACmK,IAAI;QAChBnJ,QAAQ,CAAC8I,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAACoK,IAAI;QAChBjJ,QAAQ,CAAC2I,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAACqK,KAAK;QACjBjJ,SAAS,CAAC0I,IAAI,EAAErE,KAAK,CAAC;QACtB;MACF,KAAKzF,QAAQ,CAACsK,IAAI;QAChBzJ,QAAQ,CAACiJ,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAACuK,IAAI;QAChB3J,QAAQ,CAACkJ,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAACwK,KAAK;QACjBzJ,SAAS,CAAC+I,IAAI,EAAErE,KAAK,CAAC;QACtB;MACF,KAAKzF,QAAQ,CAACyK,QAAQ;QACpBjJ,YAAY,CAACsI,IAAI,EAAErE,KAAK,CAAC;QACzB;MACF,KAAKzF,QAAQ,CAAC0K,QAAQ;QACpBnK,YAAY,CAACuJ,IAAI,EAAErE,KAAK,CAAC;QACzB;MACF,KAAKzF,QAAQ,CAAC2K,IAAI;QAChBtJ,QAAQ,CAACyI,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAAC4K,QAAQ;QACpBrJ,YAAY,CAACuI,IAAI,EAAErE,KAAK,CAAC;QACzB;MACF,KAAKzF,QAAQ,CAAC6K,QAAQ;QACpBvJ,YAAY,CAACwI,IAAI,EAAErE,KAAK,CAAC;QACzB;MACF,KAAKzF,QAAQ,CAAC8K,MAAM;QAClBrK,UAAU,CAACqJ,IAAI,EAAErE,KAAK,CAAC;QACvB;MACF,KAAKzF,QAAQ,CAAC+K,OAAO;QACnB9J,WAAW,CAAC6I,IAAI,EAAErE,KAAK,CAAC;QACxB;MACF,KAAKzF,QAAQ,CAACgL,QAAQ;QACpBrK,YAAY,CAACmJ,IAAI,EAAErE,KAAK,CAAC;QACzB;MACF,KAAKzF,QAAQ,CAACiL,SAAS;QACrBnK,aAAa,CAACgJ,IAAI,EAAErE,KAAK,CAAC;QAC1B;MACF,KAAKzF,QAAQ,CAACkL,KAAK;QACjB/K,SAAS,CAAC2J,IAAI,EAAErE,KAAK,CAAC;QACtB;MACF,KAAKzF,QAAQ,CAACmL,MAAM;QAClB7K,UAAU,CAACwJ,IAAI,EAAErE,KAAK,CAAC;QACvB;MACF,KAAKzF,QAAQ,CAACoL,IAAI;QAChB5K,QAAQ,CAACsJ,IAAI,EAAErE,KAAK,CAAC;QACrB;MACF,KAAKzF,QAAQ,CAACqL,KAAK;QACjB;QACA;MACF;QACE,IAAI,CAACjG,IAAI,CAACsD,aAAa,EAAE;UACvBP,OAAO,CAACmD,IAAI,CAAC,0BAA0B9F,IAAI,EAAE,CAAC;QAChD;IACJ;EACF,CAAC,CAAC;EACFH,QAAQ,CAACC,OAAO,CAAEC,KAAK,IAAK;IAC1B,IAAI,CAACA,KAAK,CAACmD,aAAa,EAAE;MACxBU,IAAI,CAAC1F,GAAG,EAAE6B,KAAK,CAAC;IAClB;EACF,CAAC,CAAC;EACFsD,kBAAkB,CAACnF,GAAG,EAAEkG,MAAM,CAAC;AACjC","ignoreList":[]}