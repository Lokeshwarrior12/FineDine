{"version":3,"names":["Object","defineProperty","exports","value","size","rect2rect","fitRects","_typeddash","require","width","height","src","dst","scaleX","scaleY","translateX","x","translateY","y","inscribe","rect","halfWidthDelta","halfHeightDelta","applyBoxFit","fit","input","output","Math","min","aspectRatio","exhaustiveCheck","sizes"],"sources":["Fitting.ts"],"sourcesContent":["\"worklet\";\n\nimport { exhaustiveCheck } from \"../../../renderer/typeddash\";\nimport type { SkRect } from \"../../../skia/types\";\nimport type { Fit } from \"../../types\";\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport const size = (width = 0, height = 0) => {\n  return { width, height };\n};\n\nexport const rect2rect = (\n  src: SkRect,\n  dst: SkRect\n): [\n  { translateX: number },\n  { translateY: number },\n  { scaleX: number },\n  { scaleY: number }\n] => {\n  const scaleX = dst.width / src.width;\n  const scaleY = dst.height / src.height;\n  const translateX = dst.x - src.x * scaleX;\n  const translateY = dst.y - src.y * scaleY;\n  return [{ translateX }, { translateY }, { scaleX }, { scaleY }];\n};\n\nconst inscribe = (\n  { width, height }: Size,\n  rect: { x: number; y: number; width: number; height: number }\n) => {\n  const halfWidthDelta = (rect.width - width) / 2.0;\n  const halfHeightDelta = (rect.height - height) / 2.0;\n  return {\n    x: rect.x + halfWidthDelta,\n    y: rect.y + halfHeightDelta,\n    width,\n    height,\n  };\n};\n\nconst applyBoxFit = (fit: Fit, input: Size, output: Size) => {\n  let src = size(),\n    dst = size();\n  if (\n    input.height <= 0.0 ||\n    input.width <= 0.0 ||\n    output.height <= 0.0 ||\n    output.width <= 0.0\n  ) {\n    return { src, dst };\n  }\n  switch (fit) {\n    case \"fill\":\n      src = input;\n      dst = output;\n      break;\n    case \"contain\":\n      src = input;\n      if (output.width / output.height > src.width / src.height) {\n        dst = size((src.width * output.height) / src.height, output.height);\n      } else {\n        dst = size(output.width, (src.height * output.width) / src.width);\n      }\n      break;\n    case \"cover\":\n      if (output.width / output.height > input.width / input.height) {\n        src = size(input.width, (input.width * output.height) / output.width);\n      } else {\n        src = size((input.height * output.width) / output.height, input.height);\n      }\n      dst = output;\n      break;\n    case \"fitWidth\":\n      src = size(input.width, (input.width * output.height) / output.width);\n      dst = size(output.width, (src.height * output.width) / src.width);\n      break;\n    case \"fitHeight\":\n      src = size((input.height * output.width) / output.height, input.height);\n      dst = size((src.width * output.height) / src.height, output.height);\n      break;\n    case \"none\":\n      src = size(\n        Math.min(input.width, output.width),\n        Math.min(input.height, output.height)\n      );\n      dst = src;\n      break;\n    case \"scaleDown\":\n      src = input;\n      dst = input;\n      const aspectRatio = input.width / input.height;\n      if (dst.height > output.height) {\n        dst = size(output.height * aspectRatio, output.height);\n      }\n      if (dst.width > output.width) {\n        dst = size(output.width, output.width / aspectRatio);\n      }\n      break;\n    default:\n      exhaustiveCheck(fit);\n  }\n  return { src, dst };\n};\n\nexport const fitRects = (\n  fit: Fit,\n  rect: SkRect,\n  { x, y, width, height }: SkRect\n) => {\n  const sizes = applyBoxFit(\n    fit,\n    { width: rect.width, height: rect.height },\n    { width, height }\n  );\n  const src = inscribe(sizes.src, rect);\n  const dst = inscribe(sizes.dst, {\n    x,\n    y,\n    width,\n    height,\n  });\n  return { src, dst };\n};\n"],"mappings":"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","ignoreList":[]}