{"version":3,"names":["_types","require","_types2","_Node","_RenderNode","_datatypes","BoxShadowNode","JsiDeclarationNode","constructor","ctx","props","NodeType","BoxShadow","decorate","_ctx","materialize","exports","BoxNode","JsiRenderNode","Box","renderNode","canvas","paint","box","defaultBox","opacity","getAlphaf","isRRect","Skia","RRectXY","shadows","_children","map","node","filter","n","shadow","inner","color","blur","spread","dx","dy","lPaint","Paint","setColor","Color","setAlphaf","setMaskFilter","MaskFilter","MakeBlur","BlurStyle","Normal","drawRRect","inflate","delta","Point","Math","abs","save","clipRRect","ClipOp","Intersect","deflate","outer","x","y","drawDRRect","restore"],"sources":["Box.ts"],"sourcesContent":["import { BlurStyle, ClipOp, isRRect } from \"../../../skia/types\";\nimport type { DrawingContext } from \"../../types\";\nimport { NodeType } from \"../../types\";\nimport type { BoxShadowProps, BoxProps } from \"../../types/Drawings\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport { JsiRenderNode } from \"../RenderNode\";\nimport type { DeclarationContext } from \"../../types/DeclarationContext\";\nimport { deflate, inflate } from \"../datatypes\";\n\nexport class BoxShadowNode extends JsiDeclarationNode<BoxShadowProps> {\n  constructor(ctx: NodeContext, props: BoxShadowProps) {\n    super(ctx, NodeType.BoxShadow, props);\n  }\n\n  decorate(_ctx: DeclarationContext) {\n    // do nothing\n  }\n\n  materialize() {\n    return this.props;\n  }\n}\n\nexport class BoxNode extends JsiRenderNode<BoxProps> {\n  constructor(ctx: NodeContext, props: BoxProps) {\n    super(ctx, NodeType.Box, props);\n  }\n\n  renderNode({ canvas, paint }: DrawingContext) {\n    const { box: defaultBox } = this.props;\n    const opacity = paint.getAlphaf();\n    const box = isRRect(defaultBox)\n      ? defaultBox\n      : this.Skia.RRectXY(defaultBox, 0, 0);\n    const shadows = this._children\n      .map((node) => {\n        if (node instanceof BoxShadowNode) {\n          return node.materialize();\n        }\n        return null;\n      })\n      .filter((n): n is BoxShadowProps => n !== null);\n    shadows\n      .filter((shadow) => !shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        canvas.drawRRect(\n          inflate(this.Skia, box, spread, spread, dx, dy),\n          lPaint\n        );\n      });\n\n    canvas.drawRRect(box, paint);\n\n    shadows\n      .filter((shadow) => shadow.inner)\n      .map((shadow) => {\n        const { color = \"black\", blur, spread = 0, dx = 0, dy = 0 } = shadow;\n        const delta = this.Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));\n        canvas.save();\n        canvas.clipRRect(box, ClipOp.Intersect, false);\n        const lPaint = this.Skia.Paint();\n        lPaint.setColor(this.Skia.Color(color));\n        lPaint.setAlphaf(paint.getAlphaf() * opacity);\n\n        lPaint.setMaskFilter(\n          this.Skia.MaskFilter.MakeBlur(BlurStyle.Normal, blur, true)\n        );\n        const inner = deflate(this.Skia, box, spread, spread, dx, dy);\n        const outer = inflate(this.Skia, box, delta.x, delta.y);\n        canvas.drawDRRect(outer, inner, lPaint);\n        canvas.restore();\n      });\n  }\n}\n"],"mappings":"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","ignoreList":[]}