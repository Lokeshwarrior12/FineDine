"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BoxShadowNode = exports.BoxNode = void 0;
var _types = require("../../../skia/types");
var _types2 = require("../../types");
var _Node = require("../Node");
var _RenderNode = require("../RenderNode");
var _datatypes = require("../datatypes");
class BoxShadowNode extends _Node.JsiDeclarationNode {
  constructor(ctx, props) {
    super(ctx, _types2.NodeType.BoxShadow, props);
  }
  decorate(_ctx) {
    // do nothing
  }
  materialize() {
    return this.props;
  }
}
exports.BoxShadowNode = BoxShadowNode;
class BoxNode extends _RenderNode.JsiRenderNode {
  constructor(ctx, props) {
    super(ctx, _types2.NodeType.Box, props);
  }
  renderNode({
    canvas,
    paint
  }) {
    const {
      box: defaultBox
    } = this.props;
    const opacity = paint.getAlphaf();
    const box = (0, _types.isRRect)(defaultBox) ? defaultBox : this.Skia.RRectXY(defaultBox, 0, 0);
    const shadows = this._children.map(node => {
      if (node instanceof BoxShadowNode) {
        return node.materialize();
      }
      return null;
    }).filter(n => n !== null);
    shadows.filter(shadow => !shadow.inner).map(shadow => {
      const {
        color = "black",
        blur,
        spread = 0,
        dx = 0,
        dy = 0
      } = shadow;
      const lPaint = this.Skia.Paint();
      lPaint.setColor(this.Skia.Color(color));
      lPaint.setAlphaf(paint.getAlphaf() * opacity);
      lPaint.setMaskFilter(this.Skia.MaskFilter.MakeBlur(_types.BlurStyle.Normal, blur, true));
      canvas.drawRRect((0, _datatypes.inflate)(this.Skia, box, spread, spread, dx, dy), lPaint);
    });
    canvas.drawRRect(box, paint);
    shadows.filter(shadow => shadow.inner).map(shadow => {
      const {
        color = "black",
        blur,
        spread = 0,
        dx = 0,
        dy = 0
      } = shadow;
      const delta = this.Skia.Point(10 + Math.abs(dx), 10 + Math.abs(dy));
      canvas.save();
      canvas.clipRRect(box, _types.ClipOp.Intersect, false);
      const lPaint = this.Skia.Paint();
      lPaint.setColor(this.Skia.Color(color));
      lPaint.setAlphaf(paint.getAlphaf() * opacity);
      lPaint.setMaskFilter(this.Skia.MaskFilter.MakeBlur(_types.BlurStyle.Normal, blur, true));
      const inner = (0, _datatypes.deflate)(this.Skia, box, spread, spread, dx, dy);
      const outer = (0, _datatypes.inflate)(this.Skia, box, delta.x, delta.y);
      canvas.drawDRRect(outer, inner, lPaint);
      canvas.restore();
    });
  }
}
exports.BoxNode = BoxNode;
//# sourceMappingURL=Box.js.map