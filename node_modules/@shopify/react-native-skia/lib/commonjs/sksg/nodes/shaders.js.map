{"version":3,"names":["Object","defineProperty","exports","value","declareTwoPointConicalGradientShader","declareTurbulenceShader","declareSweepGradientShader","declareShader","declareRadialGradientShader","declareLinearGradientShader","declareImageShader","declareFractalNoiseShader","declareColorShader","_nodes","require","_types","ctx","props","source","uniforms","transform","m3","Skia","Matrix","processTransformProps","shader","makeShaderWithChildren","processUniforms","shaders","popAll","push","color","Shader","MakeColor","Color","freqX","freqY","octaves","seed","tileWidth","tileHeight","MakeFractalNoise","startR","endR","start","end","colors","positions","mode","localMatrix","flags","processGradientProps","MakeTwoPointConicalGradient","c","r","MakeRadialGradient","MakeSweepGradient","x","y","MakeLinearGradient","MakeTurbulence","fit","image","tx","ty","fm","mm","imageShaderProps","rct","getRect","rects","fitRects","width","height","sx","sy","rect2rect","src","dst","translate","translateX","translateY","scale","scaleX","scaleY","lm","concat","makeShaderOptions","TileMode","enumKey","FilterMode","MipmapMode"],"sources":["shaders.ts"],"sourcesContent":["\"worklet\";\n\nimport {\n  enumKey,\n  fitRects,\n  getRect,\n  processGradientProps,\n  processTransformProps,\n  rect2rect,\n} from \"../../dom/nodes\";\nimport type {\n  ColorProps,\n  DeclarationContext,\n  FractalNoiseProps,\n  ImageShaderProps,\n  LinearGradientProps,\n  RadialGradientProps,\n  ShaderProps,\n  SweepGradientProps,\n  TurbulenceProps,\n  TwoPointConicalGradientProps,\n} from \"../../dom/types\";\nimport {\n  FilterMode,\n  MipmapMode,\n  processUniforms,\n  TileMode,\n} from \"../../skia/types\";\n\nexport const declareShader = (ctx: DeclarationContext, props: ShaderProps) => {\n  const { source, uniforms, ...transform } = props;\n  const m3 = ctx.Skia.Matrix();\n  processTransformProps(m3, transform);\n  const shader = source.makeShaderWithChildren(\n    processUniforms(source, uniforms),\n    ctx.shaders.popAll(),\n    m3\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareColorShader = (\n  ctx: DeclarationContext,\n  props: ColorProps\n) => {\n  const { color } = props;\n  const shader = ctx.Skia.Shader.MakeColor(ctx.Skia.Color(color));\n  ctx.shaders.push(shader);\n};\n\nexport const declareFractalNoiseShader = (\n  ctx: DeclarationContext,\n  props: FractalNoiseProps\n) => {\n  const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = props;\n  const shader = ctx.Skia.Shader.MakeFractalNoise(\n    freqX,\n    freqY,\n    octaves,\n    seed,\n    tileWidth,\n    tileHeight\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareTwoPointConicalGradientShader = (\n  ctx: DeclarationContext,\n  props: TwoPointConicalGradientProps\n) => {\n  const { startR, endR, start, end } = props;\n  const { colors, positions, mode, localMatrix, flags } = processGradientProps(\n    ctx.Skia,\n    props\n  );\n  const shader = ctx.Skia.Shader.MakeTwoPointConicalGradient(\n    start,\n    startR,\n    end,\n    endR,\n    colors,\n    positions,\n    mode,\n    localMatrix,\n    flags\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareRadialGradientShader = (\n  ctx: DeclarationContext,\n  props: RadialGradientProps\n) => {\n  const { c, r } = props;\n  const { colors, positions, mode, localMatrix, flags } = processGradientProps(\n    ctx.Skia,\n    props\n  );\n  const shader = ctx.Skia.Shader.MakeRadialGradient(\n    c,\n    r,\n    colors,\n    positions,\n    mode,\n    localMatrix,\n    flags\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareSweepGradientShader = (\n  ctx: DeclarationContext,\n  props: SweepGradientProps\n) => {\n  const { c, start, end } = props;\n  const { colors, positions, mode, localMatrix, flags } = processGradientProps(\n    ctx.Skia,\n    props\n  );\n  const shader = ctx.Skia.Shader.MakeSweepGradient(\n    c.x,\n    c.y,\n    colors,\n    positions,\n    mode,\n    localMatrix,\n    flags,\n    start,\n    end\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareLinearGradientShader = (\n  ctx: DeclarationContext,\n  props: LinearGradientProps\n) => {\n  const { start, end } = props;\n  const { colors, positions, mode, localMatrix, flags } = processGradientProps(\n    ctx.Skia,\n    props\n  );\n  const shader = ctx.Skia.Shader.MakeLinearGradient(\n    start,\n    end,\n    colors,\n    positions ?? null,\n    mode,\n    localMatrix,\n    flags\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareTurbulenceShader = (\n  ctx: DeclarationContext,\n  props: TurbulenceProps\n) => {\n  const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = props;\n  const shader = ctx.Skia.Shader.MakeTurbulence(\n    freqX,\n    freqY,\n    octaves,\n    seed,\n    tileWidth,\n    tileHeight\n  );\n  ctx.shaders.push(shader);\n};\n\nexport const declareImageShader = (\n  ctx: DeclarationContext,\n  props: ImageShaderProps\n) => {\n  const { fit, image, tx, ty, fm, mm, ...imageShaderProps } = props;\n  if (!image) {\n    return;\n  }\n\n  const rct = getRect(ctx.Skia, imageShaderProps);\n  const m3 = ctx.Skia.Matrix();\n  if (rct) {\n    const rects = fitRects(\n      fit,\n      { x: 0, y: 0, width: image.width(), height: image.height() },\n      rct\n    );\n    const [x, y, sx, sy] = rect2rect(rects.src, rects.dst);\n    m3.translate(x.translateX, y.translateY);\n    m3.scale(sx.scaleX, sy.scaleY);\n  }\n  const lm = ctx.Skia.Matrix();\n  lm.concat(m3);\n  processTransformProps(lm, imageShaderProps);\n  const shader = image.makeShaderOptions(\n    TileMode[enumKey(tx)],\n    TileMode[enumKey(ty)],\n    FilterMode[enumKey(fm)],\n    MipmapMode[enumKey(mm)],\n    lm\n  );\n  ctx.shaders.push(shader);\n};\n"],"mappings":"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","ignoreList":[]}