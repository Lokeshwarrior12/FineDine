{"version":3,"names":["Object","defineProperty","exports","value","draw","_types","require","_types2","_nodes","_drawings","_colorFilters","_imageFilters","_utils","_shaders","_paint","_pathEffects","composeColorFilters","ctx","cf","processChildren","Skia","save","cf1","colorFilters","popAllAsOne","restore","push","ColorFilter","MakeCompose","composePathEffects","pe","pe1","pathEffects","PathEffect","composeImageFilters","imgf1","imgf2","imageFilters","_imgf","ImageFilter","MakeColorFilter","imgf","processDeclarations","node","children","forEach","child","type","props","materialize","NodeType","BlurMaskFilter","declareBlurMaskFilter","LerpColorFilter","declareLerpColorFilter","Blend","blend","BlendMode","enumKey","mode","popAll","length","composer","MakeBlend","bind","composeDeclarations","shaders","Shader","BlendColorFilter","makeBlendColorFilter","SRGBToLinearGammaColorFilter","makeSRGBToLinearGammaColorFilter","LinearToSRGBGammaColorFilter","makeLinearToSRGBGammaColorFilter","MatrixColorFilter","makeMatrixColorFilter","LumaColorFilter","makeLumaColorFilter","declareShader","ImageShader","declareImageShader","ColorShader","declareColorShader","Turbulence","declareTurbulenceShader","FractalNoise","declareFractalNoiseShader","LinearGradient","declareLinearGradientShader","RadialGradient","declareRadialGradientShader","SweepGradient","declareSweepGradientShader","TwoPointConicalGradient","declareTwoPointConicalGradientShader","BlurImageFilter","makeBlurImageFilter","OffsetImageFilter","makeOffsetImageFilter","DisplacementMapImageFilter","declareDisplacementMapImageFilter","DropShadowImageFilter","makeDropShadowImageFilter","MorphologyImageFilter","makeMorphologyImageFilter","BlendImageFilter","declareBlendImageFilter","RuntimeShaderImageFilter","makeRuntimeShaderImageFilter","SumPathEffect","declareSumPathEffect","CornerPathEffect","pf","makeCornerPathEffect","Path1DPathEffect","makePath1DPathEffect","Path2DPathEffect","makePath2DPathEffect","Line2DPathEffect","makeLine2DPathEffect","DashPathEffect","makeDashPathEffect","DiscretePathEffect","makeDiscretePathEffect","Paint","declarePaint","console","log","preProcessContext","shouldRestoreMatrix","processMatrixAndClipping","layer","declCtx","isDeclaration","shouldRestorePaint","processPaint","postProcessContext","canvas","drawBackdropFilter","imageFilter","pop","saveLayer","undefined","BackdropFilter","Layer","hasLayer","paint","paints","map","rawProps","result","getLocalPaints","lctx","Box","drawBox","BoxShadow","drawBoxShadow","Image","drawImage","Points","drawPoints","Path","drawPath","Rect","drawRect","RRect","drawRRect","Oval","drawOval","Line","drawLine","Patch","drawPatch","Vertices","drawVertices","DiffRect","drawDiffRect","Text","drawText","TextPath","drawTextPath","TextBlob","drawTextBlob","Glyphs","drawGlyphs","Picture","drawPicture","ImageSVG","drawImageSVG","Paragraph","drawParagraph","Atlas","drawAtlas","Circle","drawCircle","Fill","drawFill","Group","warn"],"sources":["context.ts"],"sourcesContent":["\"worklet\";\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { composeDeclarations, NodeType } from \"../../dom/types\";\nimport type {\n  BlendProps,\n  DeclarationContext,\n  DrawingNodeProps,\n} from \"../../dom/types\";\nimport type { DrawingContext } from \"../DrawingContext\";\nimport { BlendMode } from \"../../skia/types\";\nimport type {\n  SkPathEffect,\n  SkColorFilter,\n  SkImageFilter,\n} from \"../../skia/types\";\nimport { enumKey } from \"../../dom/nodes\";\n\nimport type { Node } from \"./Node\";\nimport {\n  drawAtlas,\n  drawBox,\n  drawBoxShadow,\n  drawCircle,\n  drawDiffRect,\n  drawFill,\n  drawGlyphs,\n  drawImage,\n  drawImageSVG,\n  drawLine,\n  drawOval,\n  drawParagraph,\n  drawPatch,\n  drawPath,\n  drawPicture,\n  drawPoints,\n  drawRect,\n  drawRRect,\n  drawText,\n  drawTextBlob,\n  drawTextPath,\n  drawVertices,\n} from \"./drawings\";\nimport {\n  declareLerpColorFilter,\n  makeBlendColorFilter,\n  makeLinearToSRGBGammaColorFilter,\n  makeLumaColorFilter,\n  makeMatrixColorFilter,\n  makeSRGBToLinearGammaColorFilter,\n} from \"./colorFilters\";\nimport {\n  declareBlendImageFilter,\n  declareBlurMaskFilter,\n  declareDisplacementMapImageFilter,\n  makeBlurImageFilter,\n  makeDropShadowImageFilter,\n  makeMorphologyImageFilter,\n  makeOffsetImageFilter,\n  makeRuntimeShaderImageFilter,\n} from \"./imageFilters\";\nimport { materialize } from \"./utils\";\nimport {\n  declareColorShader,\n  declareFractalNoiseShader,\n  declareImageShader,\n  declareLinearGradientShader,\n  declareRadialGradientShader,\n  declareShader,\n  declareSweepGradientShader,\n  declareTurbulenceShader,\n  declareTwoPointConicalGradientShader,\n} from \"./shaders\";\nimport { declarePaint } from \"./paint\";\nimport {\n  declareSumPathEffect,\n  makeCornerPathEffect,\n  makeDashPathEffect,\n  makeDiscretePathEffect,\n  makeLine2DPathEffect,\n  makePath1DPathEffect,\n  makePath2DPathEffect,\n} from \"./pathEffects\";\n\ninterface ContextProcessingResult {\n  shouldRestoreMatrix: boolean;\n  shouldRestorePaint: boolean;\n}\n\nfunction composeColorFilters(\n  ctx: DeclarationContext,\n  cf: SkColorFilter,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  const cf1 = ctx.colorFilters.popAllAsOne();\n  ctx.restore();\n  ctx.colorFilters.push(cf1 ? Skia.ColorFilter.MakeCompose(cf, cf1) : cf);\n}\n\nfunction composePathEffects(\n  ctx: DeclarationContext,\n  pe: SkPathEffect,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  const pe1 = ctx.pathEffects.popAllAsOne();\n  ctx.restore();\n  ctx.pathEffects.push(pe1 ? Skia.PathEffect.MakeCompose(pe, pe1) : pe);\n}\n\nfunction composeImageFilters(\n  ctx: DeclarationContext,\n  imgf1: SkImageFilter,\n  processChildren: () => void\n) {\n  const { Skia } = ctx;\n  ctx.save();\n  processChildren();\n  let imgf2 = ctx.imageFilters.popAllAsOne();\n  const cf = ctx.colorFilters.popAllAsOne();\n  ctx.restore();\n  if (cf) {\n    imgf2 = Skia.ImageFilter.MakeCompose(\n      imgf2 ?? null,\n      Skia.ImageFilter.MakeColorFilter(cf, null)\n    );\n  }\n  const imgf = imgf2 ? Skia.ImageFilter.MakeCompose(imgf1, imgf2) : imgf1;\n  ctx.imageFilters.push(imgf);\n}\n\nfunction processDeclarations(ctx: DeclarationContext, node: Node<any>) {\n  const processChildren = () =>\n    node.children.forEach((child) => processDeclarations(ctx, child));\n  const { type } = node;\n  const props = materialize(node.props);\n  switch (type) {\n    // Mask Filter\n    case NodeType.BlurMaskFilter: {\n      declareBlurMaskFilter(ctx, props);\n      break;\n    }\n    // Color Filters\n    case NodeType.LerpColorFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareLerpColorFilter(ctx, props);\n      break;\n    }\n    case NodeType.Blend: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      const { Skia } = ctx;\n      const blend = BlendMode[enumKey(props.mode as BlendProps[\"mode\"])];\n      // Blend ImageFilters\n      const imageFilters = ctx.imageFilters.popAll();\n      if (imageFilters.length > 0) {\n        const composer = Skia.ImageFilter.MakeBlend.bind(\n          Skia.ImageFilter,\n          blend\n        );\n        ctx.imageFilters.push(composeDeclarations(imageFilters, composer));\n      }\n      // Blend Shaders\n      const shaders = ctx.shaders.popAll();\n      if (shaders.length > 0) {\n        const composer = Skia.Shader.MakeBlend.bind(Skia.Shader, blend);\n        ctx.shaders.push(composeDeclarations(shaders, composer));\n      }\n      break;\n    }\n    case NodeType.BlendColorFilter: {\n      const cf = makeBlendColorFilter(ctx, props);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.SRGBToLinearGammaColorFilter: {\n      const cf = makeSRGBToLinearGammaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.LinearToSRGBGammaColorFilter: {\n      const cf = makeLinearToSRGBGammaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.MatrixColorFilter: {\n      const cf = makeMatrixColorFilter(ctx, props);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    case NodeType.LumaColorFilter: {\n      const cf = makeLumaColorFilter(ctx);\n      composeColorFilters(ctx, cf, processChildren);\n      break;\n    }\n    // Shaders\n    case NodeType.Shader: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareShader(ctx, props);\n      break;\n    }\n    case NodeType.ImageShader: {\n      declareImageShader(ctx, props);\n      break;\n    }\n    case NodeType.ColorShader: {\n      declareColorShader(ctx, props);\n      break;\n    }\n    case NodeType.Turbulence: {\n      declareTurbulenceShader(ctx, props);\n      break;\n    }\n    case NodeType.FractalNoise: {\n      declareFractalNoiseShader(ctx, props);\n      break;\n    }\n    case NodeType.LinearGradient: {\n      declareLinearGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.RadialGradient: {\n      declareRadialGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.SweepGradient: {\n      declareSweepGradientShader(ctx, props);\n      break;\n    }\n    case NodeType.TwoPointConicalGradient: {\n      declareTwoPointConicalGradientShader(ctx, props);\n      break;\n    }\n    // Image Filters\n    case NodeType.BlurImageFilter: {\n      const imgf = makeBlurImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.OffsetImageFilter: {\n      const imgf = makeOffsetImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.DisplacementMapImageFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareDisplacementMapImageFilter(ctx, props);\n      break;\n    }\n    case NodeType.DropShadowImageFilter: {\n      const imgf = makeDropShadowImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.MorphologyImageFilter: {\n      const imgf = makeMorphologyImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    case NodeType.BlendImageFilter: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareBlendImageFilter(ctx, props);\n      break;\n    }\n    case NodeType.RuntimeShaderImageFilter: {\n      const imgf = makeRuntimeShaderImageFilter(ctx, props);\n      composeImageFilters(ctx, imgf, processChildren);\n      break;\n    }\n    // Path Effects\n    case NodeType.SumPathEffect: {\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declareSumPathEffect(ctx);\n      break;\n    }\n    case NodeType.CornerPathEffect: {\n      const pf = makeCornerPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Path1DPathEffect: {\n      const pf = makePath1DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Path2DPathEffect: {\n      const pf = makePath2DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.Line2DPathEffect: {\n      const pf = makeLine2DPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.DashPathEffect: {\n      const pf = makeDashPathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    case NodeType.DiscretePathEffect: {\n      const pf = makeDiscretePathEffect(ctx, props);\n      composePathEffects(ctx, pf, processChildren);\n      break;\n    }\n    // Paint\n    case NodeType.Paint:\n      node.children.forEach((child) => processDeclarations(ctx, child));\n      declarePaint(ctx, props);\n      break;\n    default:\n      console.log(\"Unknown declaration node: \", type);\n  }\n}\n\nconst preProcessContext = (\n  ctx: DrawingContext,\n  props: DrawingNodeProps,\n  node: Node<any>\n) => {\n  const shouldRestoreMatrix = ctx.processMatrixAndClipping(props, props.layer);\n  ctx.declCtx.save();\n  node.children.forEach((child) => {\n    if (child.isDeclaration) {\n      processDeclarations(ctx.declCtx, child);\n    }\n  });\n  const shouldRestorePaint = ctx.processPaint(props);\n  ctx.declCtx.restore();\n  return { shouldRestoreMatrix, shouldRestorePaint };\n};\n\nconst postProcessContext = (\n  ctx: DrawingContext,\n  { shouldRestoreMatrix, shouldRestorePaint }: ContextProcessingResult\n) => {\n  if (shouldRestoreMatrix) {\n    ctx.canvas.restore();\n  }\n  if (shouldRestorePaint) {\n    ctx.restore();\n  }\n};\n\nconst drawBackdropFilter = (ctx: DrawingContext, node: Node) => {\n  const { canvas, Skia } = ctx;\n  const child = node.children[0];\n  let imageFilter: SkImageFilter | null = null;\n  if (child.isDeclaration) {\n    ctx.declCtx.save();\n    processDeclarations(ctx.declCtx, child);\n    const imgf = ctx.declCtx.imageFilters.pop();\n    if (imgf) {\n      imageFilter = imgf;\n    } else {\n      const cf = ctx.declCtx.colorFilters.pop();\n      if (cf) {\n        imageFilter = Skia.ImageFilter.MakeColorFilter(cf, null);\n      }\n    }\n    ctx.declCtx.restore();\n  }\n  canvas.saveLayer(undefined, null, imageFilter);\n  canvas.restore();\n};\n\nexport function draw(ctx: DrawingContext, node: Node<any>) {\n  // Special mixed nodes\n  if (node.type === NodeType.BackdropFilter) {\n    drawBackdropFilter(ctx, node);\n    return;\n  }\n  if (node.type === NodeType.Layer) {\n    let hasLayer = false;\n    const [layer, ...children] = node.children;\n    if (layer.isDeclaration) {\n      const { declCtx } = ctx;\n      declCtx.save();\n      processDeclarations(ctx.declCtx, layer);\n      const paint = declCtx.paints.pop();\n      declCtx.restore();\n      if (paint) {\n        hasLayer = true;\n        ctx.canvas.saveLayer(paint);\n      }\n    }\n    children.map((child) => {\n      if (!child.isDeclaration) {\n        draw(ctx, child);\n      }\n    });\n    if (hasLayer) {\n      ctx.canvas.restore();\n    }\n    return;\n  }\n  const { type, props: rawProps, children } = node;\n  // Regular nodes\n  const props = materialize(rawProps);\n  const result = preProcessContext(ctx, props, node);\n  const paints = ctx.getLocalPaints();\n  paints.forEach((paint) => {\n    const lctx = { paint, Skia: ctx.Skia, canvas: ctx.canvas };\n    switch (type) {\n      case NodeType.Box:\n        drawBox(lctx, props, node.children);\n        break;\n      case NodeType.BoxShadow:\n        drawBoxShadow(lctx, props);\n        break;\n      case NodeType.Image:\n        drawImage(lctx, props);\n        break;\n      case NodeType.Points:\n        drawPoints(lctx, props);\n        break;\n      case NodeType.Path:\n        drawPath(lctx, props);\n        break;\n      case NodeType.Rect:\n        drawRect(lctx, props);\n        break;\n      case NodeType.RRect:\n        drawRRect(lctx, props);\n        break;\n      case NodeType.Oval:\n        drawOval(lctx, props);\n        break;\n      case NodeType.Line:\n        drawLine(lctx, props);\n        break;\n      case NodeType.Patch:\n        drawPatch(lctx, props);\n        break;\n      case NodeType.Vertices:\n        drawVertices(lctx, props);\n        break;\n      case NodeType.DiffRect:\n        drawDiffRect(lctx, props);\n        break;\n      case NodeType.Text:\n        drawText(lctx, props);\n        break;\n      case NodeType.TextPath:\n        drawTextPath(lctx, props);\n        break;\n      case NodeType.TextBlob:\n        drawTextBlob(lctx, props);\n        break;\n      case NodeType.Glyphs:\n        drawGlyphs(lctx, props);\n        break;\n      case NodeType.Picture:\n        drawPicture(lctx, props);\n        break;\n      case NodeType.ImageSVG:\n        drawImageSVG(lctx, props);\n        break;\n      case NodeType.Paragraph:\n        drawParagraph(lctx, props);\n        break;\n      case NodeType.Atlas:\n        drawAtlas(lctx, props);\n        break;\n      case NodeType.Circle:\n        drawCircle(lctx, props);\n        break;\n      case NodeType.Fill:\n        drawFill(lctx, props);\n        break;\n      case NodeType.Group:\n        // TODO: do nothing\n        break;\n      default:\n        if (!node.isDeclaration) {\n          console.warn(`Unsupported node type: ${type}`);\n        }\n    }\n  });\n  children.forEach((child) => {\n    if (!child.isDeclaration) {\n      draw(ctx, child);\n    }\n  });\n  postProcessContext(ctx, result);\n}\n"],"mappings":"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","ignoreList":[]}